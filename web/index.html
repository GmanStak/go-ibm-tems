<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>GEMS Dashboard</title>
  <style>
    body{font-family:Arial;margin:20px;background:#f5f5f5}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid #ddd;padding:8px;text-align:center}
    th{background:#f2f2f2}
    pre{background:#eee;padding:8px;border-radius:4px;white-space:pre-wrap}
  </style>
</head>
<body>
<h2>GEMS <span id="temsName">-</span> 实时 Agent 数据</h2>
<table>
  <thead>
  <tr>
    <th>主机名</th><th>IP</th><th>CPU%</th><th>内存%</th><th>磁盘%</th>
    <th>网络 ↑KB</th><th>网络 ↓KB</th><th>进程数</th><th>最后心跳</th>
  </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<script>
  async function load() {
    const data = await fetch('/api').then(r=>r.json());
    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';
    for (const [host, m] of Object.entries(data)) {
      const tr = tbody.insertRow();
      tr.insertCell(0).textContent = host;
      tr.insertCell(1).textContent = m.ip;
      tr.insertCell(2).textContent = m.cpu_percent.toFixed(1);
      tr.insertCell(3).textContent = m.mem_percent.toFixed(1);
      tr.insertCell(4).textContent = m.disk_percent.toFixed(1);
      tr.insertCell(5).textContent = (m.network.bytes_sent/1024).toFixed(0);
      tr.insertCell(6).textContent = (m.network.bytes_recv/1024).toFixed(0);
      tr.insertCell(7).textContent = m.processes?.length || 0;
      tr.insertCell(8).textContent = new Date(m.last_seen*1000).toLocaleTimeString();
    }
    document.getElementById('temsName').textContent = Object.keys(data).length;
  }
  load();
  setInterval(load, 5000);
</script>
</body>
</html>